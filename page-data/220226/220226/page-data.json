{"componentChunkName":"component---src-templates-post-template-tsx","path":"/220226/220226/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h1>[프로젝트 회고] #4 React Query를 활용한 비동기 API 구현</h1>\n<p>React Query는 React 앱에서 비동기 로직을 쉽게 다루도록 해주는 라이브러리입니다. 현재 대부분의 웹 어플리케이션은 비동기 로직을 사용한다고 볼 수 있습니다. 이는 유저에게 제공되는 데이터의 양과 질을 높일 수 있는 가장 기본적인 방식이기 때문입니다.</p>\n<p>React Query는 가비지 컬랙션, 개발자 도구 등 다양한 편의 기능을 제공하고 있습니다. React Query에 대한 기본적이 내용은 저의 <a href=\"https://sonsangjoon.github.io/220306/220306/\" target=\"_blank\" rel=\"nofollow\">블로그 글</a>에 정리해두었습니다. 아래의 내용은 프로젝트에 React Query를 사용하여 구현한 내용과 추가적인 보완사항들을 정리해봤습니다.</p>\n<ul>\n<li>Suspense와 React Query를 통한 비동기 API</li>\n<li>Infinite Queries를 활용한 무한 스크롤링 구현</li>\n<li>추가적인 보완사항</li>\n</ul>\n<br/>\n<h1>1. Suspense와 React Query를 통한 비동기 API</h1>\n<h3>React Query와 Suspense</h3>\n<p>React Query는 React Suspense를 지원합니다.\nSuspense를 사용하기 위해 전역을 설정하거나 각 쿼리별로 react suspense의 사용여부를 설정할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">//전역으로 설정</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> QueryClient<span class=\"token punctuation\">,</span> QueryClientProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-query'</span>\n\n<span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">defaultOptions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">queries</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">suspense</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Root</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>QueryClientProvider client<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>queryClient<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>App <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>QueryClientProvider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">//개별 쿼리에 대해서 설정</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useQuery <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-query'</span>\n\n<span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>queryKey<span class=\"token punctuation\">,</span> queryFn<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">suspense</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<h3>구현 방식</h3>\n<p>이처럼 react query를 사용하여 쉽게 비동기 api에 대해 suspense를 사용할 수 있게 되었습니다. 커뮤니티 게시글 목록에 suspense를 활용한 예시를 보여드리겠습니다.</p>\n<p><img src=\"https://i.imgur.com/sGOJ8IU.gif\" alt=\"Suspense\"></p>\n<p>저의 경우, 커뮤니티 게시글 목록을 비동기적으로 불러오기 때문에 Fallback으로 FeedGrid에 props로 로딩상태를 전달했습니다. 또한, 비동기 로직에서 에러가 발생했을 경우, ErrorBoundary를 따로 만들어 감싸줄 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Suspense <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">CommunityPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span>\n  <span class=\"token punctuation\">.</span>\n  <span class=\"token punctuation\">.</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>ErrorBoundary fallback<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token operator\">&lt;</span>div <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>CommunityIntro theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">}</span> handleButtonClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>handleCreation<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>MainBox<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">.</span> <span class=\"token punctuation\">.</span> <span class=\"token punctuation\">.</span>\n        <span class=\"token operator\">&lt;</span>Suspense fallback<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token operator\">&lt;</span>FeedGrid isLoading theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n          <span class=\"token operator\">&lt;</span>CommunityFeedGrid theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Suspense<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">.</span> <span class=\"token punctuation\">.</span> <span class=\"token punctuation\">.</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>MainBox<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ErrorBoundary<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> CommunityPage</code></pre></div>\n<br/>\n<h1>2. Infinite Queries를 활용한 무한 스크롤링 구현</h1>\n<h3>Infinite Queries</h3>\n<p>무한 쿼리는 기존 데이터 집합에 추가로 “더 많은” 데이터를 로드하거나 무한 스크롤할 수 있는 렌더링 목록도 매우 일반적인 UI 패턴입니다. React Query는 Infinite Queries를 통해 더욱 효율적으로 useQuery를 사용할 수 있도록 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n  data<span class=\"token punctuation\">,</span> <span class=\"token comment\">// infinite query data를 담고 있는 객체입니다.</span>\n  error<span class=\"token punctuation\">,</span>\n  fetchNextPage<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 데이터를 추가적으로 호출할 수 있도록 하는 함수입니다.</span>\n  hasNextPage<span class=\"token punctuation\">,</span> <span class=\"token comment\">//더 호출할 데이터가 있는지 boolean 형태로 반환합니다. getNextPageParam가 undefined가 아닌 이상 true를 반환합니다.</span>\n  isFetching<span class=\"token punctuation\">,</span>\n  isFetchingNextPage<span class=\"token punctuation\">,</span>\n  status<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useInfiniteQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">'projects'</span><span class=\"token punctuation\">,</span> fetchProjects<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">getNextPageParam</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">lastPage<span class=\"token punctuation\">,</span> pages</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> lastPage<span class=\"token punctuation\">.</span>nextCursor<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<h3>구현 방식</h3>\n<p>커뮤니티, 채용, 스터디 목록 모두 Infinite Queries를 사용하여 구현했습니다. 아래 예시는 커뮤니티 게시글 목록을 무한 스크롤로 구현한 내용입니다.</p>\n<p><img src=\"https://i.imgur.com/4ZxRqHa.gif\" alt=\"무한스크롤 구현\"></p>\n<p>검색 쿼리에 대한 정보와 page에 대한 정보를 params에 담아서 보냅니다.\n다만 nextPage에 대한 정보를 다시 반환했습니다.</p>\n<p>다른 예시들을 참고했을 때, 서버에서 다음 페이지에 대한 정보를 함께 보내주는 경우도 있었습니다.\n동시에 마지막 페이지일 경우에는 false를 전달해주기 위함이었습니다.</p>\n<p>저의 경우에는, 서버쪽에서 보내주지 않아 제가 직접 다음페이지에 대한 정보를 생성해주었습니다.\n또한, 마지막 페이지인지 확인하는 과정도 프론트에서 진행했습니다. 관련 내용은 바로 하단에 정리했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// getCommunityList.js</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">fetchPage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data<span class=\"token punctuation\">,</span> pageParam</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> param <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>data<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">offset</span><span class=\"token operator\">:</span> pageParam<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">axiosInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">url</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/boards/search/</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">params</span><span class=\"token operator\">:</span> param<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">res</span><span class=\"token operator\">:</span> res<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">nextPage</span><span class=\"token operator\">:</span> pageParam <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>getNextPageParam을 통해 다음 페이지에 대한 pageParam을 생성할 수 있습니다.\n제가 설정한 nextPage는 prevPage.nextPage를 통해서 가져올 수 있습니다.\n다만 마지막 페이지에 대한 정보는 prevPage.res.length를 통해 확인해 주었습니다.</p>\n<p>이때, 추가적으로 호출할 데이터가 없는 경우에는, undefined를 반환해야지 getNextPageParam이 false로 반환되니 확인이 필요합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// getCommunityList.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">GetCommunityList</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">data</span> <span class=\"token operator\">=></span>\n  <span class=\"token function\">useInfiniteQuery</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span><span class=\"token string\">'getCommunityList'</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> pageParam <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetchPage</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> pageParam<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">getNextPageParam</span><span class=\"token operator\">:</span> <span class=\"token parameter\">prevPage</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>prevPage<span class=\"token punctuation\">.</span>res<span class=\"token punctuation\">.</span>length <span class=\"token operator\">?</span> prevPage<span class=\"token punctuation\">.</span>nextPage <span class=\"token operator\">:</span> <span class=\"token keyword\">undefined</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<p>이제 커뮤니티 게시글을 페이지 단위로 정보를 불러오기 위한 기초 쿼리는 완성이 되었습니다.\n무한 스크롤의 경우, 기본적으로 2가지 방식을 통해 구현해볼 수 있습니다.</p>\n<ul>\n<li>scroll event listener: 스크롤에 대한 조건을 만족했을 경우, 추가 데이터를 가져오는 방식</li>\n<li>Intersection Observer API: 타깃으로 삼은 엘리먼트를 관찰해, 특정조건이 되면 데이터를 가져오는 방식</li>\n</ul>\n<p>저의 경우 Intersection Observer을 사용했습니다.\nMDN에 따르면, Intersection Observer API는 타겟 요소와 상위 요소 또는 최상위 document 의 viewport 사이의 intersection 내의 변화를 비동기적으로 관찰하는 API입니다. Event listener를 등록하는 방식과 다르게, dobounce나 throttle을 적용시켜주지 않아도 되며 Reflow가 발생하지 않기 때문에 성능적인 측면에서 사용하지 않을 이유가 없습니다.</p>\n<p>이에 useIntersectionObserver라는 hook을 만들어 필요한 곳에 사용할 수 있도록 했습니다.</p>\n<ul>\n<li>target: useIntersectionObserver의 객체입니다.</li>\n<li>onIntersect: target 엘레멘트와 교차했을 때 호출할 함수를 정의합니다.</li>\n<li>enabled: useIntersectionObserver의 실행 여부를 설정합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// useIntersectionObserver.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useIntersectionObserver</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> target<span class=\"token punctuation\">,</span> onIntersect<span class=\"token punctuation\">,</span> enabled <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> el <span class=\"token operator\">=</span> target<span class=\"token operator\">?.</span>current\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>enabled <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>el<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> observer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span>\n      <span class=\"token parameter\">entries</span> <span class=\"token operator\">=></span>\n        entries<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entry</span> <span class=\"token operator\">=></span> entry<span class=\"token punctuation\">.</span>isIntersecting <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">onIntersect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">threshold</span><span class=\"token operator\">:</span> <span class=\"token number\">1.0</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span>\n\n    observer<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      observer<span class=\"token punctuation\">.</span><span class=\"token function\">unobserve</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>target<span class=\"token punctuation\">,</span> enabled<span class=\"token punctuation\">,</span> onIntersect<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<p>useIntersectionObserver 게시물의 가장 하단에 추가적인 로드를 위한 컴포넌트를 넣어두었습니다.</p>\n<p>이후 Infinite Queries와 useIntersectionObserver와 연결해주었습니다.</p>\n<ul>\n<li>target: 게시물의 가장 하단의 컴포넌트로 설정했습니다.</li>\n<li>onIntersect: 교차할 경우, fetchNextPage로 추가적인 데이터를 호출하도록 했습니다.</li>\n<li>enabled: hasNextPage을 통해 추가적인 데이터 여부를 판단하여, 없을 경우 추가적인 호출을 제한했습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">CommunityFeedGrid</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">const</span> loader <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> fetchNextPage<span class=\"token punctuation\">,</span> hasNextPage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">GetCommunityList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">검색 쿼리에 대한 정보</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> feedData <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">CommunityFeedSelector</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onFetchNewData</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetchNextPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">useIntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> loader<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">onIntersect</span><span class=\"token operator\">:</span> onFetchNewData<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">enabled</span><span class=\"token operator\">:</span> hasNextPage<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span><span class=\"token operator\">!</span>feedData<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">&lt;</span>CommunityNoContent theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span>FeedGrid data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>feedData<span class=\"token punctuation\">}</span> theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>FetchBox ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>loader<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> CommunityFeedGrid</code></pre></div>\n<br/>\n<h1>3. 추가적인 보완 사항</h1>\n<h3>Optimistic Updates</h3>\n<p>Optimistic Updates이란 Mutation이 발생할 경우 미리 화면의 UI를 바꿔준 후, 서버와의 통신 결과에 따라 확정 / 롤백을 결정하는 방식이다. 말그대로 낙관적으로 바뀔 것이라고 예상하고 UI를 먼저 바꿔주는 것을 의미한다.</p>\n<p>저의 경우도, 의도치 않게 좋아요 기능을 Optimistic Updates 기반으로 구현했다고 볼 수 있습니다. 좋아요를 누를 경우 UI를 변경하고, api를 다시 호출하여 데이터의 상태를 확인하는 과정을 거쳤습니다. 그러나 이렇게 되면 불필요한 api 호출이 발생합니다.</p>\n<p>이에 React Query는 onMutate, onSettled, onError를 통해 다양한 조건을 핸들링 할 수 있도록 했습니다. 관련 내용을 아직 정확히 알지 못하여 적용하지 못했지만, 추가적으로 고민하고 구현 해볼 내용으로 기록에 남겨두기 위해 작성했습니다.</p>\n<h3>Cache, Stale</h3>\n<p><img src=\"https://i.imgur.com/2bQnzXL.gif\" alt=\"stale\"></p>\n<p>아직 React Query의 Cache를 제대로 사용해보지는 못했습니다. 자주 바꾸지 않는 콘텐츠를 대상으로 캐싱을 처리하면 좋겠지만, 이번 프로젝트에는 사용해보지 못했습니다. 다만, 메인 페이지의 상단 슬라이드의 경우 캐싱을 이용해도 될 것으로 생각됩니다. 다양한 use cases들을 참고하여 공부해 볼 필요가 있는 부분이라고 생각합니다.</p>\n<br/>\n<h1>4. 끝맺음</h1>\n<p>React Query를 사용하게 되면서, 그 동안 어떻게 비동기 api를 처리해왔는지 막막하게 느껴질 정도로 편리했습니다.\n캐싱뿐만 아니라, 반복적이 api 호출을 방지하기도 하며 Mutation이 발생했을 경우 쉽게 수정된 데이터로 업데이트 할 수도 있었습니다.\n아직까진 React query의 100%를 끌어내지 못했다고 생각하며, 추가적으로 공부해볼 필요성을 느끼기도 했습니다.</p>\n<p>참고:</p>\n<ul>\n<li><a href=\"https://velog.io/@jce1407/React-%EB%AC%B4%ED%95%9C-%EC%8A%A4%ED%81%AC%EB%A1%A4-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-with-Intersection-Observer\" target=\"_blank\" rel=\"nofollow\">React 무한 스크롤 구현하기 with Intersection Observer</a></li>\n<li><a href=\"https://react-query.tanstack.com/\" target=\"_blank\" rel=\"nofollow\">React Query</a></li>\n<li><a href=\"https://ko.reactjs.org/docs/concurrent-mode-suspense.html\" target=\"_blank\" rel=\"nofollow\">React Suspense</a></li>\n</ul>","frontmatter":{"title":"[프로젝트 회고]ssafe #4 React Query를 활용한 비동기 API 구현","summary":"ssafe 서비스를 개발하면서 생각하고 도입한 내용을 정리한 글입니다.","date":"2022.02.26.","categories":["프로젝트","프론트엔드","React Query","Suspense","싸페"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhklEQVQoz2P4T2XAQBcD//37B6chbHQ+Qg1BAxEK//3/CzXg79+/cEzIUJwuxOEADJcS5cK/UMVbzvz8v//St//nz574v3f/wf/LV6z6v3fffryGMuCz/ej1X//vPf/1/97dW/8vXrry//LlK//v3LlLmoGYYUmaHF4XYosUECbLhYMmYQMAKLplmO7aZ+kAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/5b966b032eb9105217f6346f59d30bd5/e018d/thumbnail.png","srcSet":"/static/5b966b032eb9105217f6346f59d30bd5/c6b60/thumbnail.png 480w,\n/static/5b966b032eb9105217f6346f59d30bd5/f5e84/thumbnail.png 960w,\n/static/5b966b032eb9105217f6346f59d30bd5/e018d/thumbnail.png 1920w","sizes":"(min-width: 1920px) 1920px, 100vw"},"sources":[{"srcSet":"/static/5b966b032eb9105217f6346f59d30bd5/0df1a/thumbnail.webp 480w,\n/static/5b966b032eb9105217f6346f59d30bd5/eeb31/thumbnail.webp 960w,\n/static/5b966b032eb9105217f6346f59d30bd5/702da/thumbnail.webp 1920w","type":"image/webp","sizes":"(min-width: 1920px) 1920px, 100vw"}]},"width":1920,"height":1080}},"publicURL":"/static/5b966b032eb9105217f6346f59d30bd5/thumbnail.png"}}}}]}},"pageContext":{"slug":"/220226/220226/"}},"staticQueryHashes":[]}