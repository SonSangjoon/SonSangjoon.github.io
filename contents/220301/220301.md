---
date: '2022-03-01'
title: '[프로젝트 회고] 프론트엔드 캐싱전략'
categories: ['프로젝트', '프론트엔드', 'Cloudfront', 'HTTP 캐시', '싸페']
summary: 'ssafé 서비스를 개발하면서 생각하고 도입한 내용을 정리한 글입니다.'
thumbnail: './thumbnail.png'
---

# 프론트엔드 캐싱전략

웹 성능을 높이기 위한 방식으로 캐싱을 고려할 수 있습니다. 모든 데이터에 대하여 항상 서버와 통신을 하게된다면, 데이터를 다운받는데 발생하는 로딩 시간, 서버 비용 등 비효율적인 코스트가 발생합니다.

![캐싱](https://i.imgur.com/yMC1uMH.png)

이를 개선하는 한 가지 방법으로는 HTTP 캐시 전략이 있습니다. HTTP 캐싱은 여러 레이어에서 활성화 될 수 있습니다. 따라서 HTTP 캐싱을 설정할 경우, 예기치 못한 side effect가 발생할 수 있으므로 신중히 설정해야 합니다.
저의 경우, 캐싱전략을 3가지 방식으로 적용했습니다.

- CDN을 통한 캐싱 서버
- HTTP/웹 캐싱
- API 캐싱

# 1. CloudFront, S3를 통한 CDN 배포

### CloudFront와 CDN

CloudFront란 성능, 보안 및 개발자 편의를 위해 구축된 콘텐츠 전송 네트워크 서비스(CDN)입니다. CDN이란 서버와 사용자 사이의 물리적 거리를 줄여 콘텐츠 로딩 시간을 최소화하는 콘텐츠 전송하는 기술입니다. CDN는 각 지역에 캐시 서버를 분산 배치하여, 근접한 사용자의 요청에 원본 서버가 아닌 캐시 서버에서 콘텐츠를 전달합니다.

때문에, Netflix와 같이 콘텐츠를 제공하는 글로벌 서비스에게 매우 효과적인 기술입니다. 그러나 특정 국가나 지역만을 타깃으로 하는 웹 서비스를 운영한다면 CDN 서비스를 활용할 필요가 없습니다.

### Cloudfront

프로젝트 특성상, 해외에서 접속하는 유저가 거의 없기 때문에 CDN 서비스를 사용하지 않아도 큰 문제는 없었습니다. 그러나 Cloudfront를 사용하여 S3에 직접 액세스 하는 것보다 싼 요금이 발생하고, HTTPS 적용할 수 있기 때문에 사용하기로 했습니다. 엣지 로케이션에 캐싱되어 어느정도의 로드벨런싱도 제공하지만 이는 단순 부가적인 이점으로 생각하고 있습니다. 따라서, 싸페 프로젝트 배포는 AWS S3, Cloudfront, Route 53을 활용하여 배포하였습니다.

### 구현방식

저희 프로젝트의 아키텍쳐는 다음과 같습니다.
![image](https://user-images.githubusercontent.com/74908906/158919393-278e3803-d120-4f74-80d9-1182c9612e4a.png)

도메인을 설정하기 위해서 DNS 서버로 AWS의 Route 53ㅇ
HTTPS 설정 및
각 엣지 로케이션의 서버에 캐싱되어 있게 됩니다.

# 2. Cach-control을 통한 HTTP 캐싱 설정하기

# 3. React Query로 API 캐싱하기

uses a stale-while-revalidate in-memory caching strategy (popularized by HTTP RFC 5861) and a very robust query deduping strategy to always ensure a query's data is always readily available, only cached when it's needed, even if that query is used multiple times across your application and updated in the background when possible.

# 4. 끝맺음

참고:

- [Amazon Cloudfront](https://aws.amazon.com/ko/cloudfront/)
- [클라우드 이해-CDN이란?](https://library.gabia.com/contents/infrahosting/8985/)
- [웹 서비스 캐시 똑똑하게 다루기](https://toss.tech/article/smart-web-service-cache)
